package com.vulnerabilitie.vulnerabilitiespring.config

import com.vulnerabilitie.vulnerabilitiespring.entity.Post
import com.vulnerabilitie.vulnerabilitiespring.entity.User
import com.vulnerabilitie.vulnerabilitiespring.repository.PostRepository
import com.vulnerabilitie.vulnerabilitiespring.repository.UserRepository
import org.slf4j.LoggerFactory
import org.springframework.boot.CommandLineRunner
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration

@Configuration
class Initialize {

    @Bean
    fun demo(userRepository: UserRepository, postRepository: PostRepository): CommandLineRunner {
        return CommandLineRunner {
            log.info("Create User")
            val bob = User("Bob")
            val alice = User("Alice")
            userRepository.saveAll(listOf(bob, alice))

            val bobPost = Post(
                title = "Hello Quarkus",
                content = "I`m Bob My first post of Quarkus",
                user = bob
            )
            val alicePost = Post(
                title = "Hello Again, Quarkus",
                content = "I`m Alice My second post of Quarkus",
                user = alice
            )
            postRepository.saveAll(listOf(bobPost, alicePost))

            log.info("")
            log.info("Post findAll():")
            log.info("-------------------------------")
            for (post in postRepository.findAll()) {
                log.info(post.toString())
            }
            log.info("")
        }
    }

    companion object {
        private val log = LoggerFactory.getLogger(Initialize::class.java)
    }
}